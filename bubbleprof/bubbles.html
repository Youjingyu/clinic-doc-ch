<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Bubbles（气泡）</title>
    <meta name="description" content="Node Clinic 中文文档">
    <link rel="shortcut icon" href="/clinic-doc-zh/icon.png">
  <style>
      p + blockquote, ol + blockquote,  ul + blockquote {
        display: none;
      }
    </style>
  <script>
      document.addEventListener('click', function (e) {
        var target = e.target
        var nextSibling
        if (target.tagName === 'P') {
          nextSibling = target.nextElementSibling
        } else if (target.tagName === 'LI') {
          nextSibling = target.parentNode.nextElementSibling
        }
        if (nextSibling && nextSibling.tagName === 'BLOCKQUOTE') {
          var hide = 'display:none'
          var show = 'display:block'
          var style = nextSibling.getAttribute('style')
          nextSibling.setAttribute('style', style === show ? hide : show)
        }
      })
    </script>
  <script>
      var logoUrlChanger = setInterval(function () {
        // Anchor above the logo image
        var homeEls = document.getElementsByClassName('home-link')
        if (homeEls.length > 0) {
          var homeEl = homeEls[0]
          homeEl.setAttribute('href', 'https://clinicjs.org/documentation')
          homeEl.setAttribute('onclick', "document.location='https://clinicjs.org/documentation';return false;")
          clearInterval(logoUrlChanger)
        }

        // Actual logo image
        var logoEls = document.getElementsByClassName('logo')
        if (logoEls.length > 0) {
          var logoEl = logoEls[0]
          logoEl.setAttribute('onclick', "document.location='https://clinicjs.org/documentation';return false;")
          clearInterval(logoUrlChanger)
        }
      }, 1000)
    </script>
    
    <link rel="preload" href="/clinic-doc-zh/assets/css/0.styles.feea2165.css" as="style"><link rel="preload" href="/clinic-doc-zh/assets/js/app.75a44ac4.js" as="script"><link rel="preload" href="/clinic-doc-zh/assets/js/4.7a3df476.js" as="script"><link rel="prefetch" href="/clinic-doc-zh/assets/js/10.b505e73e.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/11.032e2525.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/12.19c3aee9.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/13.9082d8b6.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/14.c6f29cca.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/15.b41e31f0.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/16.841d9223.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/17.55afc7db.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/18.f63d344f.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/19.11585fc4.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/2.e5f43561.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/20.47b55fca.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/21.9cdae012.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/22.39d2389b.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/23.2fb2fbba.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/24.1bf5b85a.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/25.4cb5b678.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/26.7f5c2c15.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/27.23216170.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/28.1707d2c7.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/29.7c788ded.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/3.a472746a.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/30.1382df70.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/31.8f6973e1.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/5.d84f4001.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/6.4af6163d.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/7.91d6fdd6.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/8.c444e8be.js"><link rel="prefetch" href="/clinic-doc-zh/assets/js/9.fcb1f222.js">
    <link rel="stylesheet" href="/clinic-doc-zh/assets/css/0.styles.feea2165.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/clinic-doc-zh/" class="home-link router-link-active"><img src="/clinic-doc-zh/logo.png" alt="" class="logo"> <!----></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"> <a href="https://github.com/Youjingyu/clinic-doc-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"> <a href="https://github.com/Youjingyu/clinic-doc-zh" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/clinic-doc-zh/" class="sidebar-link">开始</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Doctor</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Flame</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Bubbleprof</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/clinic-doc-zh/bubbleprof/preface.html" class="sidebar-link">前言</a></li><li><a href="/clinic-doc-zh/bubbleprof/setup.html" class="sidebar-link">安装</a></li><li><a href="/clinic-doc-zh/bubbleprof/getting_ready.html" class="sidebar-link">准备</a></li><li><a href="/clinic-doc-zh/bubbleprof/first_analysis.html" class="sidebar-link">首次分析</a></li><li><a href="/clinic-doc-zh/bubbleprof/bubbles.html" class="active sidebar-link">Bubbles（气泡）</a></li><li><a href="/clinic-doc-zh/bubbleprof/the_sidebar.html" class="sidebar-link">侧边栏</a></li><li><a href="/clinic-doc-zh/bubbleprof/finding_the_first_bottleneck.html" class="sidebar-link">寻找第一个瓶颈</a></li><li><a href="/clinic-doc-zh/bubbleprof/improving_our_latency.html" class="sidebar-link">改善延迟</a></li><li><a href="/clinic-doc-zh/bubbleprof/parallel_queries.html" class="sidebar-link">并行查询</a></li><li><a href="/clinic-doc-zh/bubbleprof/caching_the_results.html" class="sidebar-link">缓存结果</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="bubbles（气泡）"><a href="#bubbles（气泡）" aria-hidden="true" class="header-anchor">#</a> Bubbles（气泡）</h1> <p>让我们深入了解这些气泡意义以及如何解释它们。</p> <blockquote><p>Let's dive into what these mean and how to interpret them.</p></blockquote> <ul><li>一个气泡代表一组异步操作。</li></ul> <blockquote><p>A bubble represents a group of async operations.</p></blockquote> <ul><li>在一组异步操作中花费的时间越多，气泡越大。</li></ul> <blockquote><p>The more time spent within a group of async operations, the bigger the bubble is.</p></blockquote> <ul><li>气泡之间的线越长，说明它们之间存在越大的延迟。</li></ul> <blockquote><p>The longer the lines between bubbles, the more latency exists between them.</p></blockquote> <p>气泡基于一些启发式方法将异步时间分组。</p> <blockquote><p>The way bubbles group together async time is based on a couple of heuristics.</p></blockquote> <p>已分析的代码分为3个区域 - 用户区（正在分析的应用程序），依赖项（第三方模块）和 Node 核心代码。</p> <blockquote><p>Profiled code is grouped into 3 areas - userland (the application being profiled), dependencies (3rd party modules), and node core.</p></blockquote> <p>每当异步操作从一个空间跨越到另一个空间时，它就会定义一个气泡的边界。</p> <blockquote><p>Whenever an async operation crosses from one space into another it defines the boundry of a bubble.</p></blockquote> <p>点击其中的气泡，可以显示它由哪些气泡组成。</p> <blockquote><p>Clicking on a bubble steps inside it to show the bubbles it's composed of.</p></blockquote> <p>例如，单击底部名为 mongojs 的黄色气泡。从 UI 界面中可以看到它包含用户区代码并且是浅蓝色的。</p> <blockquote><p>For example, try clicking on the yellow bubble at the bottom called mongojs. The UI tells us it contains userland code as well as it has a lightblue color.</p></blockquote> <p><img src="https://clinicjs.org/static/0f556ce11f2e75b01aa17f083ce1bf5e/71c55/04-A.png" alt></p> <p>在这里，我们看到有两个较小的气泡。如果我们点击第一个，因为它没有子气泡，所以会显示创建它的操作的堆栈跟踪。</p> <blockquote><p>In here we see that there are two smaller bubbles. If we click on the first one it'll show the stack trace for the operation that created this as it has no sub bubbles.</p></blockquote> <p>这里的堆栈跟踪实际上是多个异步操作的组合堆栈。用户区代码会突出显示，以帮助你定位触发此气泡的代码。在这个例子里，它告诉我们它来自 <code>1-server-with-no-index.js</code> 中的第10行。</p> <blockquote><p>This stack trace is actually a combined stack trace by multiple async operations. The userland code is highlighted to help you navigate to your code that triggered this bubble. In this case it tells us that it was from line 10 in 1-server-with-no-index.js.</p></blockquote> <p>如果我们查看源文件，会看到第10行看起来像这样：</p> <blockquote><p>If we look into the source file we'll see that line 10 looks like this:</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>col<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">{</span>modified<span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">limit</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span>err<span class="token punctuation">,</span> newest<span class="token punctuation">)</span> <span class="token punctuation">{</span>
</code></pre></div><p>这是有道理的，因为这是一个 mongodb 查询。实际上，如果我们查看页面上的其他黄色气泡，我们会看到它在其回调内包含了对下一个查询的引用。这些链接表明这些气泡是串行执行的。</p> <blockquote><p>Which makes sense, as this is a mongodb query. In fact if we look at the other yellow bubble on the page, we'll see that it contains a reference to the next query inside its callback. This link indicates that these bubbles are executed in series.</p></blockquote></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/Youjingyu/clinic-doc-zh/edit/master/docs/bubbleprof/bubbles.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/clinic-doc-zh/bubbleprof/first_analysis.html" class="prev">
          首次分析
        </a></span> <span class="next"><a href="/clinic-doc-zh/bubbleprof/the_sidebar.html">
          侧边栏
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/clinic-doc-zh/assets/js/app.75a44ac4.js" defer></script><script src="/clinic-doc-zh/assets/js/4.7a3df476.js" defer></script>
  </body>
</html>
